<nav class="navbar navbar-expand-lg navbar-custom">
  <div class="container-fluid">

    <!-- Row: Logo | Nav Links | Search & Actions -->
    <div class="d-flex align-items-center justify-content-between w-100 flex-lg-nowrap">

      <!-- Logo -->
      <a class="navbar-brand me-3" [routerLink]="['/']">
        <img src="img/logo-brand.png" alt="kalaksat-logo" style="width: 100px;">
      </a>

      <!-- Nav Links (Desktop) -->
      <div class="collapse navbar-collapse order-2 order-lg-1 flex-grow-1 d-none d-lg-block" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/products']" [queryParams]="{ mode: 'new' }" queryParamsHandling="merge"
              routerLinkActive="active">New Cars</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/products']" [queryParams]="{ mode: 'used' }"
              queryParamsHandling="merge" routerLinkActive="active">Used Cars</a>
          </li>
          <li class="nav-item">
            <a class="nav-link">About Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/finance" routerLinkActive="active">Finance</a>
          </li>
        </ul>
      </div>

      <!-- Search (Desktop only) -->
      <div class="search-container d-none d-lg-block mx-3 order-3 flex-grow-1">
        <input type="text" class="form-control search-input" placeholder="Search for Cars" [(ngModel)]="searchQuery"
          (keyup.enter)="performSearch()" />
      </div>

      <!-- Right Side Actions (including mobile toggler/search) -->
      <div class="navbar-actions d-flex align-items-center gap-2 order-4 ms-lg-auto mt-2 mt-lg-0">

        <!-- Mobile Search Icon -->
        <button class="search icon-button d-lg-none" (click)="toggleMobileSearch()" title="Search">
          <!-- Search SVG -->
          <svg width="32" height="31" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>

        <!-- Language Button -->
        <button class="icon-button" (click)="toggleLanguage()" title="Change Language">
          <!-- Globe SVG -->
          <svg width="32" height="31" viewBox="0 0 32 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M16 29.25C23.5937 29.25 29.75 23.0937 29.75 15.5C29.75 7.90625 23.5937 1.75 16 1.75M16 29.25C8.40625 29.25 2.25 23.0937 2.25 15.5C2.25 7.90625 8.40625 1.75 16 1.75M16 29.25C19.75 29.25 21 23 21 15.5C21 8 19.75 1.75 16 1.75M16 29.25C12.25 29.25 11 23 11 15.5C11 8 12.25 1.75 16 1.75M3.5 20.5H28.5M3.5 10.5H28.5"
              stroke="white" stroke-width="3.33333" />
          </svg>
        </button>

        <!-- Sign In -->
       <div class="user-menu" [ngClass]="{ 'logged-in': isLoggedInValue }">
      <!-- Sign In Button (Not Logged In) -->
      <button 
        class="sign-in-button" 
        *ngIf="!isLoggedInValue" 
        (click)="toggleDropdown()"
        [class.active]="dropdownOpen()">
        <div class="user-icon">
          <svg width="32" height="31" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M19 10.75C19 12.0761 18.4732 13.3479 17.5355 14.2855C16.5979 15.2232 15.3261 15.75 14 15.75C12.6739 15.75 11.4021 15.2232 10.4645 14.2855C9.52678 13.3479 9 12.0761 9 10.75C9 9.42392 9.52678 8.15215 10.4645 7.21447C11.4021 6.27678 12.6739 5.75 14 5.75C15.3261 5.75 16.5979 6.27678 17.5355 7.21447C18.4732 8.15215 19 9.42392 19 10.75ZM16.5 10.75C16.5 11.413 16.2366 12.0489 15.7678 12.5178C15.2989 12.9866 14.663 13.25 14 13.25C13.337 13.25 12.7011 12.9866 12.2322 12.5178C11.7634 12.0489 11.5 11.413 11.5 10.75C11.5 10.087 11.7634 9.45107 12.2322 8.98223C12.7011 8.51339 13.337 8.25 14 8.25C14.663 8.25 15.2989 8.51339 15.7678 8.98223C16.2366 9.45107 16.5 10.087 16.5 10.75Z"
              fill="currentColor" />
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M14 0.75C6.40625 0.75 0.25 6.90625 0.25 14.5C0.25 22.0937 6.40625 28.25 14 28.25C21.5937 28.25 27.75 22.0937 27.75 14.5C27.75 6.90625 21.5937 0.75 14 0.75ZM2.75 14.5C2.75 17.1125 3.64125 19.5175 5.135 21.4275C6.1843 20.0502 7.53769 18.9339 9.08955 18.1659C10.6414 17.3979 12.3497 16.9989 14.0812 17C15.7905 16.998 17.4776 17.3864 19.0139 18.1355C20.5502 18.8846 21.8952 19.9746 22.9462 21.3225C24.0293 19.902 24.7585 18.244 25.0736 16.4857C25.3887 14.7275 25.2805 12.9194 24.7581 11.2112C24.2357 9.50304 23.314 7.94381 22.0694 6.66255C20.8247 5.38128 19.2928 4.41482 17.6005 3.84314C15.9081 3.27145 14.104 3.11096 12.3373 3.37497C10.5707 3.63897 8.89224 4.31986 7.44096 5.36132C5.98968 6.40277 4.80726 7.77484 3.99154 9.36399C3.17581 10.9532 2.75023 12.7137 2.75 14.5ZM14 25.75C11.4174 25.7542 8.91268 24.8657 6.91 23.235C7.71601 22.0808 8.78899 21.1384 10.0376 20.4881C11.2862 19.8378 12.6734 19.4988 14.0812 19.5C15.4715 19.4988 16.8419 19.8293 18.0787 20.4641C19.3155 21.099 20.383 22.0197 21.1925 23.15C19.1743 24.8338 16.6283 25.7541 14 25.75Z"
              fill="currentColor" />
          </svg>
        </div>
        <span class="sign-in-text">Sign In</span>
      </button>

      <!-- User Profile Button (Logged In) -->
      <div *ngIf="isLoggedInValue" class="profile-toggle" (click)="toggleDropdown()" [class.active]="dropdownOpen()">
        <div class="user-initial">{{ userInitialValue }}</div>
        <div class="hamburger-menu">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <!-- Dropdown Menu -->
      <div class="dropdown-menu" *ngIf="dropdownOpen()" [class.show]="dropdownOpen()">
        <!-- Not Logged In Dropdown -->
        <ng-container *ngIf="!isLoggedInValue">
          <div class="sign-in-dropdown">
            <div class="sign-in-header">
              <div class="user-icon-large">
                <svg width="40" height="40" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M19 10.75C19 12.0761 18.4732 13.3479 17.5355 14.2855C16.5979 15.2232 15.3261 15.75 14 15.75C12.6739 15.75 11.4021 15.2232 10.4645 14.2855C9.52678 13.3479 9 12.0761 9 10.75C9 9.42392 9.52678 8.15215 10.4645 7.21447C11.4021 6.27678 12.6739 5.75 14 5.75C15.3261 5.75 16.5979 6.27678 17.5355 7.21447C18.4732 8.15215 19 9.42392 19 10.75ZM16.5 10.75C16.5 11.413 16.2366 12.0489 15.7678 12.5178C15.2989 12.9866 14.663 13.25 14 13.25C13.337 13.25 12.7011 12.9866 12.2322 12.5178C11.7634 12.0489 11.5 11.413 11.5 10.75C11.5 10.087 11.7634 9.45107 12.2322 8.98223C12.7011 8.51339 13.337 8.25 14 8.25C14.663 8.25 15.2989 8.51339 15.7678 8.98223C16.2366 9.45107 16.5 10.087 16.5 10.75Z"
                    fill="#666" />
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M14 0.75C6.40625 0.75 0.25 6.90625 0.25 14.5C0.25 22.0937 6.40625 28.25 14 28.25C21.5937 28.25 27.75 22.0937 27.75 14.5C27.75 6.90625 21.5937 0.75 14 0.75ZM2.75 14.5C2.75 17.1125 3.64125 19.5175 5.135 21.4275C6.1843 20.0502 7.53769 18.9339 9.08955 18.1659C10.6414 17.3979 12.3497 16.9989 14.0812 17C15.7905 16.998 17.4776 17.3864 19.0139 18.1355C20.5502 18.8846 21.8952 19.9746 22.9462 21.3225C24.0293 19.902 24.7585 18.244 25.0736 16.4857C25.3887 14.7275 25.2805 12.9194 24.7581 11.2112C24.2357 9.50304 23.314 7.94381 22.0694 6.66255C20.8247 5.38128 19.2928 4.41482 17.6005 3.84314C15.9081 3.27145 14.104 3.11096 12.3373 3.37497C10.5707 3.63897 8.89224 4.31986 7.44096 5.36132C5.98968 6.40277 4.80726 7.77484 3.99154 9.36399C3.17581 10.9532 2.75023 12.7137 2.75 14.5ZM14 25.75C11.4174 25.7542 8.91268 24.8657 6.91 23.235C7.71601 22.0808 8.78899 21.1384 10.0376 20.4881C11.2862 19.8378 12.6734 19.4988 14.0812 19.5C15.4715 19.4988 16.8419 19.8293 18.0787 20.4641C19.3155 21.099 20.383 22.0197 21.1925 23.15C19.1743 24.8338 16.6283 25.7541 14 25.75Z"
                    fill="#666" />
                </svg>
              </div>
              <div class="sign-in-content">
                <h3>Sign In</h3>
                <p>Don't have an account?</p>
                <button class="sign-in-link" (click)="navigateToSignIn()">Sign in</button>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Logged In Dropdown -->
        <ng-container *ngIf="isLoggedInValue">
          <div class="user-dropdown">
            <div class="user-info">
              <div class="user-avatar">{{ userInitialValue }}</div>
              <div class="user-details">
                <div class="user-name">{{ userNameValue }}</div>
                <div class="user-phone">{{ userPhoneValue }}</div>
              </div>
            </div>
            
            <hr class="divider">
            
            <div class="menu-items">
              <a routerLink="/personal-info" class="menu-item" (click)="closeDropdown()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Personal Information
              </a>
              
              <a routerLink="/buy-request" class="menu-item" (click)="closeDropdown()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="1" y="3" width="15" height="13"></rect>
                  <path d="m16 8 2 2-2 2"></path>
                  <path d="M21 12H9"></path>
                </svg>
                Buy Car Request
              </a>
              
              <a routerLink="/sell-request" class="menu-item" (click)="closeDropdown()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18l-2 13H5L3 6z"></path>
                  <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Sell Car Request
              </a>
              
              <hr class="divider">
              
              <button class="menu-item logout-btn" (click)="logout()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16,17 21,12 16,7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Logout
              </button>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Overlay -->
      <div class="dropdown-overlay" *ngIf="dropdownOpen()" (click)="closeDropdown()"></div>
    </div>
        

        <!-- Toggler (for mobile) -->
        <button class="navbar-toggler d-lg-none" type="button" (click)="toggleNavbar()"
          [attr.aria-expanded]="isNavbarOpen()" aria-controls="navbarNav" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

    </div>

    <!-- Mobile Toggle Menu -->
    <div class="collapse  d-lg-none" [class.show]="isNavbarOpen()" id="mobileNavbar">
      <div class="mobile-menu-container d-flex justify-content-between align-items-start w-100 mt-3">

        <!-- Left Side: Navigation Links -->
        <div class="mobile-nav-links">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" (click)="closeModal()" [routerLink]="['/products']" [queryParams]="{ mode: 'new' }" queryParamsHandling="merge"
              routerLinkActive="active">New Cars</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" (click)="closeModal()" [routerLink]="['/products']" [queryParams]="{ mode: 'used' }" queryParamsHandling="merge"
              routerLinkActive="active">Used Cars</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" (click)="closeModal()">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" routerLink="/finance" routerLinkActive="active" (click)="closeModal()">Finance</a>
            </li>
          </ul>
        </div>

      </div>
    </div>

    <!-- Mobile Search (expandable) -->
    <div class="mobile-search-container" [class.show]="isMobileSearchOpen()">
      <input type="text" class="form-control mobile-search-input" placeholder="Search for Cars"
        [(ngModel)]="searchQuery" (keyup.enter)="performSearch()" (blur)="closeMobileSearch()" />
    </div>

  </div>
</nav>