<div class="car-details-container" *ngIf="car(); else loadingTemplate">
  <!-- Header -->
  <div class="car-header">
    <h1 class="car-title">{{ car().full_name }}</h1>
  </div>

  <!-- Main Content -->
  <div class="row">
    <!-- Gallery Section -->
    <div class="col-lg-6 col-md-12">
      <div class="gallery-container">
        <p-galleria [value]="galleryImages" [responsiveOptions]="responsiveOptions"
          [containerStyle]="{ 'max-width': '100%' }" [showThumbnails]="true" [showIndicators]="false"
          [showItemNavigators]="true" [circular]="true" [autoPlay]="false" [thumbnailsPosition]="'bottom'"
          [numVisible]="galleryImages.length">

          <ng-template pTemplate="item" let-item>
            <img [src]="item" alt="car-mainImage" class="gallery-main-image" />
          </ng-template>

          <ng-template pTemplate="thumbnail" let-item>
            <div class="gallery-thumbnail-wrapper">
              <img [src]="item || item.url" alt="car-thumbnailImage" class="gallery-thumbnail" />
            </div>
          </ng-template>
        </p-galleria>

        <!-- Gallery Actions -->
        <div class="gallery-actions">
          <button type="button" class="btn btn_360">
            <svg fill="#000000" height="44" width="44" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-48 -48 576.00 576.00" xml:space="preserve"
              stroke="#000000" stroke-width="3.3600000000000003">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC"
                stroke-width="2.88"></g>
              <g id="SVGRepo_iconCarrier">
                <g>
                  <g>
                    <g>
                      <path
                        d="M391.502,210.725c-5.311-1.52-10.846,1.555-12.364,6.865c-1.519,5.31,1.555,10.846,6.864,12.364 C431.646,243.008,460,261.942,460,279.367c0,12.752-15.51,26.749-42.552,38.402c-29.752,12.82-71.958,22.2-118.891,26.425 l-40.963-0.555c-0.047,0-0.093-0.001-0.139-0.001c-5.46,0-9.922,4.389-9.996,9.865c-0.075,5.522,4.342,10.06,9.863,10.134 l41.479,0.562c0.046,0,0.091,0.001,0.136,0.001c0.297,0,0.593-0.013,0.888-0.039c49.196-4.386,93.779-14.339,125.538-28.024 C470.521,316.676,480,294.524,480,279.367C480,251.424,448.57,227.046,391.502,210.725z">
                      </path>
                      <path
                        d="M96.879,199.333c-5.522,0-10,4.477-10,10c0,5.523,4.478,10,10,10H138v41.333H96.879c-5.522,0-10,4.477-10,10 s4.478,10,10,10H148c5.523,0,10-4.477,10-10V148c0-5.523-4.477-10-10-10H96.879c-5.522,0-10,4.477-10,10s4.478,10,10,10H138 v41.333H96.879z">
                      </path>
                      <path
                        d="M188.879,280.667h61.334c5.522,0,10-4.477,10-10v-61.333c0-5.523-4.477-10-10-10h-51.334V158H240c5.523,0,10-4.477,10-10 s-4.477-10-10-10h-51.121c-5.523,0-10,4.477-10,10v122.667C178.879,276.19,183.356,280.667,188.879,280.667z M198.879,219.333 h41.334v41.333h-41.334V219.333z">
                      </path>
                      <path
                        d="M291.121,280.667h61.334c5.522,0,10-4.477,10-10V148c0-5.523-4.478-10-10-10h-61.334c-5.522,0-10,4.477-10,10v122.667 C281.121,276.19,285.599,280.667,291.121,280.667z M301.121,158h41.334v102.667h-41.334V158z">
                      </path>
                      <path
                        d="M182.857,305.537c-3.567-4.216-9.877-4.743-14.093-1.176c-4.217,3.567-4.743,9.876-1.177,14.093l22.366,26.44 c-47.196-3.599-89.941-12.249-121.37-24.65C37.708,308.06,20,293.162,20,279.367c0-16.018,23.736-33.28,63.493-46.176 c5.254-1.704,8.131-7.344,6.427-12.598c-1.703-5.253-7.345-8.13-12.597-6.427c-23.129,7.502-41.47,16.427-54.515,26.526 C7.674,252.412,0,265.423,0,279.367c0,23.104,21.178,43.671,61.242,59.48c32.564,12.849,76.227,21.869,124.226,25.758 l-19.944,22.104c-3.7,4.1-3.376,10.424,0.725,14.123c1.912,1.726,4.308,2.576,6.696,2.576c2.731,0,5.453-1.113,7.427-3.301 l36.387-40.325c1.658-1.837,2.576-4.224,2.576-6.699v-0.764c0-2.365-0.838-4.653-2.365-6.458L182.857,305.537z">
                      </path>
                      <path
                        d="M381.414,137.486h40.879c5.522,0,10-4.477,10-10V86.592c0-5.523-4.478-10-10-10h-40.879c-5.522,0-10,4.477-10,10v40.894 C371.414,133.009,375.892,137.486,381.414,137.486z M391.414,96.592h20.879v20.894h-20.879V96.592z">
                      </path>
                    </g>
                  </g>
                </g>
              </g>
            </svg>

            View 360
          </button>
          <button type="button" class="btn gallery">
            <svg width="45" height="44" viewBox="0 0 45 44" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M22.4992 12.5144C22.9432 12.5144 23.3689 12.338 23.6828 12.0241C23.9967 11.7102 24.1731 11.2844 24.1731 10.8405C24.1731 10.3966 23.9967 9.97085 23.6828 9.65694C23.3689 9.34304 22.9432 9.16669 22.4992 9.16669C22.0553 9.16669 21.6296 9.34304 21.3156 9.65694C21.0017 9.97085 20.8254 10.3966 20.8254 10.8405C20.8254 11.2844 21.0017 11.7102 21.3156 12.0241C21.6296 12.338 22.0553 12.5144 22.4992 12.5144ZM33.6606 12.5144C33.8804 12.5144 34.098 12.4711 34.3011 12.3869C34.5042 12.3028 34.6887 12.1795 34.8441 12.0241C34.9996 11.8687 35.1229 11.6841 35.207 11.4811C35.2911 11.278 35.3344 11.0603 35.3344 10.8405C35.3344 10.6207 35.2911 10.4031 35.207 10.2C35.1229 9.99689 34.9996 9.81237 34.8441 9.65694C34.6887 9.50151 34.5042 9.37822 34.3011 9.2941C34.098 9.20998 33.8804 9.16669 33.6606 9.16669C33.2166 9.16669 32.7909 9.34304 32.477 9.65694C32.1631 9.97085 31.9867 10.3966 31.9867 10.8405C31.9867 11.2844 32.1631 11.7102 32.477 12.0241C32.7909 12.338 33.2166 12.5144 33.6606 12.5144ZM11.3379 12.5144C11.5577 12.5144 11.7754 12.4711 11.9784 12.3869C12.1815 12.3028 12.366 12.1795 12.5215 12.0241C12.6769 11.8687 12.8002 11.6841 12.8843 11.4811C12.9684 11.278 13.0117 11.0603 13.0117 10.8405C13.0117 10.6207 12.9684 10.4031 12.8843 10.2C12.8002 9.99689 12.6769 9.81237 12.5215 9.65694C12.366 9.50151 12.1815 9.37822 11.9784 9.2941C11.7754 9.20998 11.5577 9.16669 11.3379 9.16669C10.894 9.16669 10.4682 9.34304 10.1543 9.65694C9.84041 9.97085 9.66406 10.3966 9.66406 10.8405C9.66406 11.2844 9.84041 11.7102 10.1543 12.0241C10.4682 12.338 10.894 12.5144 11.3379 12.5144ZM22.4992 23.6739C22.9432 23.6739 23.3689 23.4975 23.6828 23.1836C23.9967 22.8697 24.1731 22.4439 24.1731 22C24.1731 21.5561 23.9967 21.1303 23.6828 20.8164C23.3689 20.5025 22.9432 20.3262 22.4992 20.3262C22.0553 20.3262 21.6296 20.5025 21.3156 20.8164C21.0017 21.1303 20.8254 21.5561 20.8254 22C20.8254 22.4439 21.0017 22.8697 21.3156 23.1836C21.6296 23.4975 22.0553 23.6739 22.4992 23.6739ZM33.6606 23.6739C34.1045 23.6739 34.5302 23.4975 34.8441 23.1836C35.158 22.8697 35.3344 22.4439 35.3344 22C35.3344 21.5561 35.158 21.1303 34.8441 20.8164C34.5302 20.5025 34.1045 20.3262 33.6606 20.3262C33.2166 20.3262 32.7909 20.5025 32.477 20.8164C32.1631 21.1303 31.9867 21.5561 31.9867 22C31.9867 22.4439 32.1631 22.8697 32.477 23.1836C32.7909 23.4975 33.2166 23.6739 33.6606 23.6739ZM11.3379 23.6739C11.7818 23.6739 12.2076 23.4975 12.5215 23.1836C12.8354 22.8697 13.0117 22.4439 13.0117 22C13.0117 21.5561 12.8354 21.1303 12.5215 20.8164C12.2076 20.5025 11.7818 20.3262 11.3379 20.3262C10.894 20.3262 10.4682 20.5025 10.1543 20.8164C9.84041 21.1303 9.66406 21.5561 9.66406 22C9.66406 22.4439 9.84041 22.8697 10.1543 23.1836C10.4682 23.4975 10.894 23.6739 11.3379 23.6739ZM22.4992 34.8334C22.9432 34.8334 23.3689 34.657 23.6828 34.3431C23.9967 34.0292 24.1731 33.6034 24.1731 33.1595C24.1731 32.7156 23.9967 32.2898 23.6828 31.9759C23.3689 31.662 22.9432 31.4857 22.4992 31.4857C22.0553 31.4857 21.6296 31.662 21.3156 31.9759C21.0017 32.2898 20.8254 32.7156 20.8254 33.1595C20.8254 33.6034 21.0017 34.0292 21.3156 34.3431C21.6296 34.657 22.0553 34.8334 22.4992 34.8334ZM33.6606 34.8334C34.1045 34.8334 34.5302 34.657 34.8441 34.3431C35.158 34.0292 35.3344 33.6034 35.3344 33.1595C35.3344 32.7156 35.158 32.2898 34.8441 31.9759C34.5302 31.662 34.1045 31.4857 33.6606 31.4857C33.2166 31.4857 32.7909 31.662 32.477 31.9759C32.1631 32.2898 31.9867 32.7156 31.9867 33.1595C31.9867 33.6034 32.1631 34.0292 32.477 34.3431C32.7909 34.657 33.2166 34.8334 33.6606 34.8334ZM11.3379 34.8334C11.7818 34.8334 12.2076 34.657 12.5215 34.3431C12.8354 34.0292 13.0117 33.6034 13.0117 33.1595C13.0117 32.7156 12.8354 32.2898 12.5215 31.9759C12.2076 31.662 11.7818 31.4857 11.3379 31.4857C10.894 31.4857 10.4682 31.662 10.1543 31.9759C9.84041 32.2898 9.66406 32.7156 9.66406 33.1595C9.66406 33.6034 9.84041 34.0292 10.1543 34.3431C10.4682 34.657 10.894 34.8334 11.3379 34.8334Z"
                stroke="black" stroke-width="2.75" stroke-linecap="round" stroke-linejoin="round" />
            </svg>

            Gallery <span
              style="border-radius: 50px; padding: 5px; background-color: #EEEDED; width: 36px; height: 34px;">{{
              car().images.length || 4 }}</span>
          </button>
          <button type="button" class="btn imperfictions">
            <svg width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20.1678 18.3333H23.8345V27.5H20.1678V18.3333ZM20.166 29.3333H23.8327V33H20.166V29.3333Z"
                fill="black" />
              <path
                d="M25.2419 7.69999C24.6039 6.49916 23.3609 5.75299 22.0006 5.75299C20.6403 5.75299 19.3973 6.49916 18.7593 7.70182L5.30626 33.1173C5.00844 33.6757 4.86097 34.3019 4.87833 34.9344C4.89568 35.567 5.07727 36.1842 5.40526 36.7253C5.72865 37.2692 6.18859 37.7191 6.73947 38.0304C7.29034 38.3417 7.91302 38.5036 8.54576 38.5H35.4554C36.7534 38.5 37.9286 37.8363 38.5978 36.7253C38.9257 36.1842 39.1073 35.567 39.1247 34.9344C39.142 34.3019 38.9946 33.6757 38.6968 33.1173L25.2419 7.69999ZM8.54576 34.8333L22.0006 9.41782L35.4646 34.8333H8.54576Z"
                fill="black" />
            </svg>

            Imperfections
          </button>
        </div>
      </div>
    </div>

    <!-- Specifications Section -->
    <div class="col-lg-6 col-md-12">
      <div class="specifications-container">
        <div class="specs-grid">
          <div class="spec-item red-icon">
            <div class="spec-icon">
              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M34.4652 15.6367L31.7648 17.9511C29.891 16.1531 27.5998 14.7873 25.0527 14.0148L26.0898 10.6242C29.287 11.5957 32.1511 13.3395 34.4652 15.6367ZM36.0442 17.3957L33.3514 19.7037C34.8977 21.6736 36.0121 23.7614 36.5487 26.2966L40.1579 26.5329C39.5673 23.1202 38.1191 19.9975 36.0442 17.3957ZM22.7419 13.4906L23.7879 10.0711C19.8018 9.36938 15.878 9.85489 12.384 11.3319L13.8634 14.5562C16.6409 13.4363 19.5529 13.0371 22.7419 13.4906ZM25.7651 49.4598L24.2094 46.2047C14.9762 48.4902 4.48348 42.4698 3.54457 30.8776L0 30.9581C1.12734 46.4109 15.7336 52.5781 25.7651 49.4598ZM3.5877 28.5129C4.07285 23.0194 7.22988 18.2822 11.7478 15.612L10.2633 12.3764C4.50938 15.6396 0.50332 21.6391 0.0257812 28.5938L3.5877 28.5129ZM24.9076 32.9133L60 30.1957V29.2505L24.4349 26.7693C25.82 28.545 25.8046 30.6314 24.9075 32.9134M23.844 29.7233C23.844 27.1859 21.0784 25.5914 18.8776 26.8602C16.6771 28.1289 16.6771 31.3178 18.8776 32.5865C21.0784 33.8551 23.844 32.2607 23.844 29.7233Z"
                  fill="#E02027" />
              </svg>

            </div>
            <div class="spec-content">
              <h6>Fuel Economy <br>({{car().performance.fuel_economy.formate}})</h6>
              <p class="spec-value">{{ car().specifications.body_style.name }}</p>
            </div>
          </div>

          <div class="spec-item">
            <div class="spec-icon">
              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M7.5 25V40M30 12.5V20M25 12.5H35M12.5 32.5H7.5M15 25H20L25 20H33.455C33.9192 20.0002 34.3741 20.1297 34.7688 20.3739C35.1636 20.6181 35.4825 20.9673 35.69 21.3825L39.31 28.6175C39.5175 29.0327 39.8364 29.3819 40.2312 29.6261C40.6259 29.8703 41.0808 29.9998 41.545 30H45V25H50C50.663 25 51.2989 25.2634 51.7678 25.7322C52.2366 26.2011 52.5 26.837 52.5 27.5V42.5C52.5 43.163 52.2366 43.7989 51.7678 44.2678C51.2989 44.7366 50.663 45 50 45H45V40H37.5V45C37.5 45.663 37.2366 46.2989 36.7678 46.7678C36.2989 47.2366 35.663 47.5 35 47.5H26.3375C25.926 47.5001 25.5209 47.3986 25.158 47.2045C24.7952 47.0104 24.4859 46.7298 24.2575 46.3875L20 40H15V25Z"
                  stroke="#E02027" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>

            </div>
            <div class="spec-content">
              <h6>Engine Capacity</h6>
              <p class="spec-value">{{ car().performance.engine_capacity_cc }}</p>
            </div>
          </div>

          <div class="spec-item red-icon">
            <div class="spec-icon">
              <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="128.000000pt" height="128.000000pt"
                viewBox="0 0 128.000000 128.000000" preserveAspectRatio="xMidYMid meet">

                <g transform="translate(0.000000,128.000000) scale(0.100000,-0.100000)" fill="#E02027" stroke="none">
                  <path
                    d="M525 1208 c-32 -17 -45 -39 -45 -75 0 -51 -25 -100 -59 -117 -40 -21 -62 -20 -115 6 -36 17 -51 19 -78 12 -27 -8 -41 -24 -85 -99 -29 -50 -53 -101 -53 -115 0 -33 22 -63 65 -90 48 -30 64 -83 40 -134 -9 -20 -21 -36 -25 -36 -5 0 -25 -15 -44 -34 -48 -45 -46 -70 14 -176 64 -112 95 -128 170 -90 47 24 71 25 111 4 33 -17 59 -66 59 -113 0 -72 33 -91 160 -91 127 0 160 19 160 91 0 47 26 96 59 113 40 21 64 20 111 -4 75 -38 106 -22 170 90 60 106 62 131 14 176 -19 19 -39 34 -44 34 -4 0 -15 16 -25 35 -20 45 -13 86 22 117 103 91 104 97 30 223 -44 75 -58 91 -85 99 -27 7 -42 5 -78 -12 -53 -26 -75 -27 -115 -6 -33 17 -59 66 -59 113 0 72 -33 91 -162 91 -51 0 -102 -6 -113 -12z m227 -45 c12 -10 18 -30 18 -57 0 -111 108 -166 228 -115 43 18 57 9 109 -77 54 -90 55 -116 3 -149 -48 -30 -70 -70 -70 -125 0 -55 22 -95 70 -125 51 -32 51 -54 4 -137 -63 -109 -70 -112 -147 -78 -94 42 -197 -23 -197 -124 0 -65 -18 -76 -128 -76 -114 0 -132 10 -132 74 0 80 -63 139 -147 139 -23 0 -53 -7 -67 -16 -52 -34 -69 -24 -130 81 -47 83 -47 105 4 137 48 30 70 70 70 125 0 55 -22 95 -70 125 -52 33 -52 55 2 151 49 85 69 96 129 69 103 -47 209 15 209 122 0 64 15 73 127 73 76 0 100 -4 115 -17z" />
                  <path
                    d="M565 961 c-100 -27 -179 -91 -222 -180 -23 -47 -27 -69 -27 -141 0 -72 4 -94 27 -141 32 -67 98 -131 165 -161 66 -30 198 -30 264 0 67 30 133 94 165 161 23 47 27 69 27 141 0 72 -4 94 -27 141 -32 67 -99 132 -165 160 -52 22 -160 33 -207 20z m206 -64 c105 -54 159 -143 159 -259 0 -97 -45 -183 -125 -238 l-43 -30 -7 31 c-4 18 -16 50 -26 73 -10 22 -19 50 -19 60 0 18 3 17 28 -6 37 -36 73 -43 111 -24 53 28 51 53 -20 193 -48 95 -71 128 -91 137 -15 6 -37 24 -49 39 -25 32 -59 33 -73 2 -5 -11 -31 -34 -59 -50 -85 -52 -147 -140 -173 -250 -11 -50 -12 -50 -23 -22 -19 49 -13 146 13 202 34 73 69 110 138 144 88 44 172 44 259 -2z m-101 -62 c5 -14 17 -25 28 -25 26 0 42 -21 103 -138 57 -111 58 -134 6 -140 -19 -2 -30 4 -43 23 -9 14 -32 32 -51 40 -23 10 -39 26 -49 50 -8 20 -20 34 -27 32 -17 -6 -9 -58 13 -82 10 -11 23 -42 28 -70 6 -27 18 -71 28 -96 26 -68 18 -79 -63 -78 -96 1 -135 17 -146 60 -25 96 12 220 95 314 24 27 43 59 44 74 1 14 2 34 3 44 2 25 20 21 31 -8z m-70 -41 c0 -4 -18 -27 -41 -51 -64 -70 -102 -160 -103 -249 -1 -41 -4 -74 -7 -74 -3 0 -14 9 -24 21 -33 36 -9 163 48 253 37 58 127 129 127 100z" />
                </g>
              </svg>
            </div>
            <div class="spec-content">
              <h6>Horsepower</h6>
              <p class="spec-value">{{ car().performance.horsepower.formate }}</p>
            </div>
          </div>

          <div class="spec-item">
            <div class="spec-icon">
              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M10.63 50C8.89667 50 7.42083 49.3917 6.2025 48.175C4.98417 46.9617 4.375 45.4867 4.375 43.75C4.375 42.2533 4.85167 40.9317 5.805 39.785C6.75833 38.6383 7.94833 37.9267 9.375 37.65V22.35C7.94833 22.075 6.75833 21.3642 5.805 20.2175C4.85167 19.0692 4.375 17.7467 4.375 16.25C4.375 14.5133 4.9825 13.0383 6.1975 11.825C7.41083 10.6083 8.885 10 10.62 10C12.355 10 13.8308 10.6083 15.0475 11.825C16.2642 13.0417 16.8733 14.5167 16.875 16.25C16.875 17.7467 16.3983 19.0692 15.445 20.2175C14.4917 21.3642 13.3017 22.0758 11.875 22.3525V28.75H28.75V22.35C27.3233 22.075 26.1333 21.3642 25.18 20.2175C24.2267 19.0692 23.75 17.7467 23.75 16.25C23.75 14.5133 24.3575 13.0383 25.5725 11.825C26.7858 10.6083 28.26 10 29.995 10C31.73 10 33.2058 10.6083 34.4225 11.825C35.6392 13.0417 36.2483 14.5167 36.25 16.25C36.25 17.7467 35.7733 19.0692 34.82 20.2175C33.8667 21.3642 32.6767 22.0758 31.25 22.3525V28.75H44.425C45.4533 28.75 46.335 28.3825 47.07 27.6475C47.805 26.9108 48.1725 26.0283 48.1725 25V22.35C46.7475 22.075 45.5575 21.3642 44.6025 20.2175C43.6492 19.0692 43.1725 17.7467 43.1725 16.25C43.1725 14.5133 43.78 13.0383 44.995 11.825C46.2083 10.6083 47.6825 10 49.4175 10C51.1525 10 52.6292 10.6083 53.8475 11.825C55.0658 13.0417 55.6742 14.5167 55.6725 16.25C55.6725 17.7467 55.1958 19.0692 54.2425 20.2175C53.2892 21.3642 52.0992 22.0758 50.6725 22.3525V25C50.6725 26.7367 50.065 28.2117 48.85 29.425C47.635 30.6417 46.16 31.25 44.425 31.25H31.25V37.65C32.6767 37.925 33.8667 38.6358 34.82 39.7825C35.7733 40.9308 36.25 42.2533 36.25 43.75C36.25 45.4867 35.6433 46.9617 34.43 48.175C33.215 49.3917 31.74 50 30.005 50C28.27 50 26.7942 49.3917 25.5775 48.175C24.3608 46.9583 23.7517 45.4833 23.75 43.75C23.75 42.2533 24.2267 40.9317 25.18 39.785C26.1333 38.6383 27.3233 37.9267 28.75 37.65V31.25H11.875V37.65C13.3017 37.925 14.4917 38.6358 15.445 39.7825C16.3983 40.9308 16.875 42.2533 16.875 43.75C16.875 45.4867 16.2683 46.9617 15.055 48.175C13.84 49.3917 12.365 50 10.63 50ZM10.625 47.5C11.6533 47.5 12.5358 47.1325 13.2725 46.3975C14.0075 45.6608 14.375 44.7783 14.375 43.75C14.375 42.7217 14.0075 41.8392 13.2725 41.1025C12.5358 40.3675 11.6533 40 10.625 40C9.59667 40 8.71417 40.3675 7.9775 41.1025C7.2425 41.8392 6.875 42.7217 6.875 43.75C6.875 44.7783 7.2425 45.6608 7.9775 46.3975C8.71417 47.1325 9.59667 47.5 10.625 47.5ZM10.625 20C11.6533 20 12.5358 19.6325 13.2725 18.8975C14.0075 18.1608 14.375 17.2783 14.375 16.25C14.375 15.2217 14.0075 14.3392 13.2725 13.6025C12.5358 12.8675 11.6533 12.5 10.625 12.5C9.59667 12.5 8.71417 12.8675 7.9775 13.6025C7.2425 14.3392 6.875 15.2217 6.875 16.25C6.875 17.2783 7.2425 18.1608 7.9775 18.8975C8.71417 19.6325 9.59667 20 10.625 20ZM30 47.5C31.0283 47.5 31.9108 47.1325 32.6475 46.3975C33.3825 45.6608 33.75 44.7783 33.75 43.75C33.75 42.7217 33.3825 41.8392 32.6475 41.1025C31.9125 40.3658 31.03 39.9983 30 40C28.97 40.0017 28.0875 40.3692 27.3525 41.1025C26.6175 41.8358 26.25 42.7183 26.25 43.75C26.25 44.7817 26.6175 45.6642 27.3525 46.3975C28.0892 47.1325 28.9717 47.5 30 47.5ZM30 20C31.0283 20 31.9108 19.6325 32.6475 18.8975C33.3825 18.1608 33.75 17.2783 33.75 16.25C33.75 15.2217 33.3825 14.3392 32.6475 13.6025C31.9108 12.8675 31.0283 12.5 30 12.5C28.9717 12.5 28.0892 12.8675 27.3525 13.6025C26.6158 14.3375 26.2483 15.22 26.25 16.25C26.2517 17.28 26.6192 18.1625 27.3525 18.8975C28.0892 19.6325 28.9717 20 30 20ZM49.425 20C50.4533 20 51.335 19.6325 52.07 18.8975C52.805 18.1608 53.1725 17.2783 53.1725 16.25C53.1725 15.2217 52.805 14.3392 52.07 13.6025C51.335 12.8675 50.4525 12.5 49.4225 12.5C48.3925 12.5 47.5108 12.8675 46.7775 13.6025C46.0408 14.3392 45.6725 15.2217 45.6725 16.25C45.6725 17.2783 46.0408 18.1608 46.7775 18.8975C47.5125 19.6325 48.3942 20 49.4225 20"
                  fill="#E02027" />
              </svg>

            </div>
            <div class="spec-content">
              <h6>Transmission</h6>
              <p class="spec-value">{{ car().specifications.transmission_type.name }}</p>
            </div>
          </div>

          <div class="spec-item red-icon">
            <div class="spec-icon">
              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M7.5 7.5V24.375H11.25V13.9444L27.3056 30L11.25 46.0556V35.625H7.5V52.5H24.375V48.75H13.9444L30 32.6944L46.0556 48.75H35.625V52.5H52.5V35.625H48.75V46.0556L32.6944 30L48.75 13.9444V24.375H52.5V7.5H35.625V11.25H46.0556L30 27.3056L13.9444 11.25H24.375V7.5H7.5Z"
                  fill="#E02027" />
              </svg>

            </div>
            <div class="spec-content">
              <h6>Size</h6>
              <p class="spec-value">{{ car().appearance.size.formate }}</p>
            </div>
          </div>
          <div class="spec-item red-icon">
            <div class="spec-icon">
              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5 20H35M5 32.5H35M26.25 40V47.5M35 50H47.5C49.4891 50 51.3968 49.2098 52.8033 47.8033C54.2098 46.3968 55 44.4891 55 42.5C55 40.5109 54.2098 38.6032 52.8033 37.1967C51.3968 35.7902 49.4891 35 47.5 35H42.5V20L55 7.5M5 11.25H35V55H5V11.25Z"
                  stroke="#E02027" stroke-width="3.75" />
                <path d="M50 12.5V26.25H42.5" stroke="#E02027" stroke-width="3.75" />
              </svg>

            </div>
            <div class="spec-content">
              <h6>Engine Type</h6>
              <p class="spec-value">{{ car().performance.engine_type.name }}</p>
            </div>
          </div>
        </div>

        <!-- Pricing -->
        <div class="pricing-section">
          <h5>Pricing</h5>
          <div class="price-display">
            <span class="price" style="color: #000;">EGP</span>
            <span class="price">{{ formatPrice(car().pricing.final_price) }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button type="button" class="btn btn-danger btn-lg" style="flex: 1;" (click)="bookVisit()">
            Book Visit
          </button>
          <button type="button" class="btn btn-outline-danger btn-lg" style="flex: 1;" (click)="openFinancingModal()">
            Financing
          </button>
           <!-- Financing Modal -->
      <app-financing-modal 
        [isOpen]="isModalOpen" 
        (modalClosed)="closeFinancingModal()">
      </app-financing-modal>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs Section -->
  <div class="tabs-section col-lg-6 col-12">
    <p-tabs value="0">
      <!-- Tab Headers -->
      <p-tablist>
        <p-tab value="0">Car Summary</p-tab>
        <p-tab value="1">Overview</p-tab>
        <p-tab value="conditions">Inspection</p-tab>
        <p-tab value="features">Features</p-tab>
        <p-tab value="4">Financing</p-tab>
      </p-tablist>

      <!-- Tab Panels -->
      <p-tabpanels>
        <!-- Car Summary -->
        <p-tabpanel value="0">
          <div class="car-summary-content">
           <div class="row">
            <div class="col-md-4 col-sm-6 col-12 summary-item" *ngFor="let flag of car()?.flags">
              <div class="feature-card">
                <div class="feature-icon red-icon">
                  <!-- Flag image instead of SVG -->
                  <img [src]="environment.photoUrl + flag.image" width="45" height="44" alt="flag" />
                </div>
                <div class="feature-content">
                  <h6>{{ flag.value }}</h6>
                </div>
              </div>
            </div>
          </div>
          </div>

        </p-tabpanel>

        <!-- Overview -->
        <p-tabpanel value="1">
          <div class="tab-content">
            <div class="overview-card">
                <div class="row">
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Brand</p>
                    <p class="headerValue">{{car().brand.name}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Model</p>
                    <p class="headerValue">{{car().model.name}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Year</p>
                    <p class="headerValue">{{car().model_year}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Trim</p>
                    <p class="headerValue">{{car().trim.name}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Color</p>
                    <p class="headerValue">{{car().appearance.color}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Kilometers</p>
                    <p class="headerValue">{{car().performance.mileage.formate}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Transmission</p>
                    <p class="headerValue">{{car().specifications.transmission_type.name}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Body Style</p>
                    <p class="headerValue">{{car().specifications.body_style.name}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">License Valid to</p>
                    <p class="headerValue">{{car().license_valid_until || '-'}}</p>
                  </div>
                </div>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                  <div class="overview-items">
                    <p class="headerName">Engine Capacity CC</p>
                    <p class="headerValue">{{car().performance.engine_capacity_cc}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </p-tabpanel>

        <!-- INSPECTION -->
<p-tabpanel value="conditions">
  <div class="tab-content">
    <div class="condition-categories">
      <div class="condition-item"
           *ngFor="let item of conditionCategories"
           (click)="conditionCategories.length && openConditionItem('conditions', item.category)">
        <div class="condition-header">
          <h3>{{ item.title }}</h3>
          <i class="arrow-icon">&#8250;</i>
        </div>
      </div>
    </div>
  </div>
</p-tabpanel>

<!-- FEATURES -->
<p-tabpanel value="features">
  <div class="tab-content">
    <div class="condition-categories">
      <div class="condition-item"
           *ngFor="let item of featureCategories"
           (click)="featureCategories.length && openConditionItem('features', item.category)">
        <div class="condition-header">
          <h3>{{ item.title }}</h3>
          <i class="arrow-icon">&#8250;</i>
        </div>
      </div>
    </div>
  </div>
</p-tabpanel>

        <!-- Financing -->
        <p-tabpanel value="4">
          <div class="tab-content finance">
            <div class="overview-card">
            <div class="finance-grid">
             <div class="calculator-content">
              <!-- Car Price Slider -->
              <div class="slider-group">
                <label class="slider-label">
                  carPrice
                </label>
                <!-- Display input and slider based on mode -->
                <p-inputnumber  [(ngModel)]="price" inputId="currency-eg"
                  mode="currency" currency="EGP" locale="en-US" [min]="minCarPrice" [max]="maxCarPrice" (ngModelChange)="onCarPriceChange()" disabled />
              </div>

              <!-- Down Payment Slider (Percentage) isActive ==carPrice -->
              <!-- Down Payment -->
              <div class="slider-group">
                <div class="payment-info" [ngStyle]="{ display: 'flex' }">
                  <label class="slider-label">Down Payment</label>
                  <span class="amount-display">
                    {{downPaymentPercentage}} %
                   <span class="amount">{{ formatCurrency(downPaymentAmount || 0) }}</span></span>
                </div>

                <div class="slider-container">
                  <p-slider  [(ngModel)]="downPaymentPercentage"
                    [min]="minDownPaymentPercentage" [max]="maxDownPaymentPercentage" [step]="5"
                    (onChange)="onDownPaymentPercentageChange()" class="custom-slider percentage-slider">
                  </p-slider>
                  <!-- Slider Value Floating Label -->
                  <div class="slider-value-float" [ngStyle]="{
                  left: ((downPaymentPercentage - minDownPaymentPercentage) / (maxDownPaymentPercentage - minDownPaymentPercentage) * 100) + '%'}">
                    {{ downPaymentPercentage + '%' }}
                  </div>
                </div>
              </div>


              <!-- Loan Tenor Slider -->
              <div class="slider-group">
                <label class="slider-label">Loan Tenor</label>
                <div class="slider-container">
                  <p-slider [(ngModel)]="loanTenor" [min]="minLoanTenor" [max]="maxLoanTenor" [step]="12"
                    (onChange)="onLoanTenorChange()" class="custom-slider">
                  </p-slider>
                  <div class="slider-value-float" [ngStyle]="{
                        left: (((loanTenor - minLoanTenor) / (maxLoanTenor - minLoanTenor) * 100)) + '%'
                        }">
                    {{ loanTenor + 'Month' || 0 }}
                  </div>
                  <div class="slider-marks">
                    <span class="mark" *ngFor="let mark of [12, 24, 36, 48, 60, 72, 84]">{{mark}}</span>
                  </div>

                </div>
              </div>
            </div>
            <!-- Monthly Installment Display -->
        <div class="installment-section">
          <p-card class="installment-card">
            <div class="installment-content">
              <h3>Monthly Installment</h3>

              <!-- Monthly Installment Input -->
              <div class="installment-input-group">
                <div class="text-start" style="color: #000; font-size: 25px;">
                  {{formatCurrency(monthlyInstallmentInput)}}
                </div>

              </div>

              <p-button label="Apply For Financing" class="apply-btn" (onClick)="applyForFinancing()">
              </p-button>
            </div>
          </p-card>
        </div>

            </div>
          </div>
          </div>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-container">
    <p-skeleton height="3rem" class="mb-3" />
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <p-skeleton height="400px" class="mb-3" />
          <div class="d-flex gap-2">
            <p-skeleton height="80px" width="80px" *ngFor="let i of [1,2,3,4,5,6]" />
          </div>
        </div>
        <div class="col-lg-4">
          <p-skeleton height="300px" />
        </div>
      </div>
    </div>

  </div>
</ng-template>

<!-- Popup Modal -->
<div class="popup-overlay" [class.active]="isPopupOpen" (click)="closePopup()">
  <div class="popup-container" *ngIf="currentTabConfig" (click)="$event.stopPropagation()">

    <div class="popup-header">
      <div class="car-info">
        <img [src]="environment.photoUrl + car().images[0].location" alt="Car" class="car-icon" />
        <div class="car-details">
          <h2>{{ currentTabConfig.title }}</h2>
          <p>{{ currentTabConfig.subtitle }}</p>
        </div>
      </div>
      <button class="close-btn" (click)="closePopup()">×</button>
    </div>

    <!-- Nav between sub tabs -->
    <div class="tab-navigation-container">
      <div class="swiper-wrapper">
        <div class="swiper-slide"
             *ngFor="let tab of currentTabConfig.tabs; let i = index">
          <button class="tab-btn"
                  [class.active]="activeTabIndex === i"
                  (click)="activeTabIndex = i">
            {{ tab.title }}
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL BODY -->
    <div class="modal-body">
      <div class="content-container" *ngIf="getCurrentTab()">

        <h3 class="content-title">{{ getCurrentTab()?.title }}</h3>

        <!-- CONDITION type -->
        <div class="condition-list" *ngIf="isConditionData(getCurrentTab()?.data)">
          <div class="condition-detail-item"
               *ngFor="let item of getCurrentTab()?.data">
            <img class="condition-icon"
                 [src]="environment.photoUrl + item.image"
                 *ngIf="item.image"
                 alt="" />

            <div class="condition-info">
              <h4>{{ item.part }}</h4>
              <p>{{ item.description || '-' }}</p>
            </div>
          </div>
        </div>

        <!-- FEATURE type -->
        <div class="feature-list" *ngIf="isFeatureData(getCurrentTab()?.data)">
          <div class="feature-item"
               *ngFor="let item of getCurrentTab()?.data">
            <div class="feature-label">{{ item.label }}</div>
            <div class="feature-value">{{ item.value }}</div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
